<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cost Projection Analysis</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM CDNs -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX compilation in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Recharts Dependencies - Pinning to 2.12.7 for stable UMD support -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=JetBrains+Mono:wght@700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains+Mono', monospace; }
        /* Custom range slider styling */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #eab308;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }
        input[type=range].accent-cyan-400::-webkit-slider-thumb {
            background: #22d3ee;
        }
        /* Scrollbar styling */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="bg-[#0a0e12] text-slate-100 selection:bg-yellow-500/30 overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // Use safe destructuring from Recharts global
        const { 
            AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, 
            ResponsiveContainer 
        } = window.Recharts || {};

        // Simple Lucide Icon component
        const Icon = ({ name, className, size = 16 }) => {
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [name]);

            return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
        };

        const App = () => {
            const initialBaseCost = 1887701.34;
            const [annualIncreaseA, setAnnualIncreaseA] = useState(7.5);
            const [annualIncreaseB, setAnnualIncreaseB] = useState(10.5);
            const [isComparisonMode, setIsComparisonMode] = useState(false);
            const startYear = 2026;

            const formatCurrency = (val) => {
                if (typeof val !== 'number' || isNaN(val)) return 'R 0';
                return new Intl.NumberFormat('en-ZA', {
                    style: 'currency',
                    currency: 'ZAR',
                    maximumFractionDigits: 0,
                }).format(val);
            };

            const projectionData = useMemo(() => {
                const data = [];
                let accA = 0;
                let accB = 0;
                let costA = initialBaseCost;
                let costB = initialBaseCost;

                for (let i = 0; i < 10; i++) {
                    const year = startYear + i;
                    const incA = costA * (annualIncreaseA / 100);
                    const endA = costA + incA;
                    accA += endA;

                    const incB = costB * (annualIncreaseB / 100);
                    const endB = costB + incB;
                    accB += endB;

                    data.push({
                        year,
                        scenarioA: Math.round(endA),
                        scenarioB: Math.round(endB),
                        totalA: Math.round(accA),
                        totalB: Math.round(accB),
                        delta: Math.round(accB - accA)
                    });
                    costA = endA;
                    costB = endB;
                }
                return data;
            }, [annualIncreaseA, annualIncreaseB]);

            const stats = useMemo(() => {
                const last = projectionData[9] || { totalA: 0, totalB: 0, delta: 0 };
                const totalA = last.totalA;
                const totalB = last.totalB;
                const variance = last.delta;
                const pct = totalA > 0 ? ((totalB / totalA - 1) * 100).toFixed(1) : "0.0";
                return { totalA, totalB, variance, pct };
            }, [projectionData]);

            // Custom Tooltip Component
            const CustomTooltip = ({ active, payload, label }) => {
                if (active && payload && payload.length) {
                    return (
                        <div className="bg-[#0d1117] border border-slate-700 p-4 rounded-xl shadow-2xl backdrop-blur-md">
                            <p className="text-slate-400 font-bold mb-2 uppercase tracking-widest text-[10px]">{label} Forecast</p>
                            <div className="space-y-2">
                                <div className="flex justify-between gap-8 items-center">
                                    <span className="text-xs text-yellow-500 flex items-center gap-2 font-bold">
                                        <div className="w-2 h-2 rounded-full bg-yellow-500" /> Scenario A:
                                    </span>
                                    <span className="text-xs font-mono font-bold text-white">{formatCurrency(payload[0].value)}</span>
                                </div>
                                {isComparisonMode && payload[1] && (
                                    <div className="flex justify-between gap-8 items-center pt-2 border-t border-slate-800">
                                        <span className="text-xs text-cyan-400 flex items-center gap-2 font-bold">
                                            <div className="w-2 h-2 rounded-full bg-cyan-400" /> Scenario B:
                                        </span>
                                        <span className="text-xs font-mono font-bold text-white">{formatCurrency(payload[1].value)}</span>
                                    </div>
                                )}
                            </div>
                        </div>
                    );
                }
                return null;
            };

            if (!AreaChart) {
                return <div className="min-h-screen flex items-center justify-center text-slate-500 font-bold uppercase tracking-widest">Loading Visualization Engine...</div>;
            }

            return (
                <div className="min-h-screen p-4 md:p-8">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <header className="flex flex-col lg:flex-row justify-between items-start lg:items-end gap-6 mb-12">
                            <div className="space-y-2">
                                <div className="flex items-center gap-3">
                                    <div className="p-2.5 bg-yellow-500/10 rounded-xl ring-1 ring-yellow-500/20 text-yellow-500">
                                        <Icon name="zap" size={24} />
                                    </div>
                                    <h1 className="text-4xl font-bold tracking-tight text-white uppercase">Cost Analysis</h1>
                                </div>
                                <p className="text-slate-400 text-sm max-w-xl leading-relaxed">
                                    Forecasting utility liabilities over a 10-year horizon. 
                                    Calibrated against <span className="text-white font-bold underline decoration-yellow-500 underline-offset-4">2025 actual expenditure.</span>
                                </p>
                            </div>

                            <div className="flex flex-wrap gap-4 w-full lg:w-auto">
                                <div className="bg-[#151b23] border border-slate-700 p-5 rounded-2xl shadow-xl flex-1 lg:flex-none min-w-[220px]">
                                    <span className="text-[10px] text-slate-400 font-bold uppercase tracking-widest block mb-2">10yr Projection (A)</span>
                                    <div className="text-3xl font-mono font-bold text-yellow-500">
                                        <span className="text-sm mr-1">R</span>{(stats.totalA / 1000000).toFixed(2)}M
                                    </div>
                                </div>
                                {isComparisonMode && (
                                    <div className="bg-[#151b23] border border-cyan-700/50 p-5 rounded-2xl shadow-xl flex-1 lg:flex-none min-w-[220px] animate-pulse">
                                        <span className="text-[10px] text-cyan-400 font-bold uppercase tracking-widest block mb-2">Scenario Delta (B-A)</span>
                                        <div className="text-3xl font-mono font-bold text-cyan-400">
                                            <span className="text-sm mr-1">+ R</span>{(stats.variance / 1000000).toFixed(2)}M
                                        </div>
                                    </div>
                                )}
                            </div>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-4 gap-8">
                            {/* Controls */}
                            <div className="lg:col-span-1 space-y-6">
                                <div className="bg-[#151b23] border border-slate-700 rounded-3xl overflow-hidden shadow-2xl">
                                    <div className="p-6 border-b border-slate-700 bg-slate-800/40 flex items-center justify-between">
                                        <h3 className="text-xs font-bold text-white uppercase tracking-widest">Parameters</h3>
                                        <Icon name="trending-up" className="text-slate-400" />
                                    </div>
                                    <div className="p-6 space-y-8">
                                        <div>
                                            <label className="text-[10px] font-black text-slate-400 uppercase block mb-3">2025 Base Cost</label>
                                            <div className="flex items-center justify-between bg-[#0d1117] p-4 rounded-xl border border-slate-700">
                                                <span className="text-sm font-mono text-white font-bold">{formatCurrency(initialBaseCost)}</span>
                                                <Icon name="lock" className="text-slate-600" size={12} />
                                            </div>
                                        </div>
                                        <div className="space-y-4">
                                            <div className="flex justify-between items-center">
                                                <label className="text-[10px] font-black text-yellow-500 uppercase tracking-tighter">Scenario A Growth</label>
                                                <span className="text-xs font-mono font-black bg-yellow-500 text-black px-2 py-1 rounded-md">{annualIncreaseA}%</span>
                                            </div>
                                            <input 
                                                type="range" min="0" max="25" step="0.1"
                                                value={annualIncreaseA}
                                                onChange={(e) => setAnnualIncreaseA(parseFloat(e.target.value))}
                                                className="w-full h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer"
                                            />
                                        </div>
                                        <div className="pt-6 border-t border-slate-700">
                                            <button 
                                                onClick={() => setIsComparisonMode(!isComparisonMode)}
                                                className={`w-full flex items-center justify-center gap-2 py-3 px-4 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${
                                                    isComparisonMode ? 'bg-cyan-500 text-black shadow-lg' : 'bg-slate-700 text-slate-100'
                                                }`}
                                            >
                                                <Icon name="arrow-right-left" size={14} />
                                                {isComparisonMode ? 'Disable Comparison' : 'Compare Scenarios'}
                                            </button>
                                        </div>
                                        {isComparisonMode && (
                                            <div className="space-y-4 pt-6 border-t border-slate-700">
                                                <div className="flex justify-between items-center">
                                                    <label className="text-[10px] font-black text-cyan-400 uppercase tracking-tighter">Scenario B Growth</label>
                                                    <span className="text-xs font-mono font-black bg-cyan-400 text-black px-2 py-1 rounded-md">{annualIncreaseB}%</span>
                                                </div>
                                                <input 
                                                    type="range" min="0" max="25" step="0.1"
                                                    value={annualIncreaseB}
                                                    onChange={(e) => setAnnualIncreaseB(parseFloat(e.target.value))}
                                                    className="w-full h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-cyan-400"
                                                />
                                            </div>
                                        )}
                                    </div>
                                </div>
                                <div className="p-5 bg-blue-500/5 border border-blue-500/10 rounded-2xl flex gap-3">
                                    <Icon name="info" className="text-blue-400 shrink-0" size={16} />
                                    <p className="text-[11px] text-slate-500 leading-relaxed italic">
                                        Compounding calculations assume annual adjustments from January 2026. Audit logs reflect end-of-period accumulation.
                                    </p>
                                </div>
                            </div>

                            {/* Chart Area */}
                            <div className="lg:col-span-3 space-y-8">
                                <div className="bg-[#151b23] border border-slate-700 p-8 rounded-3xl shadow-sm relative overflow-hidden">
                                    <div className="absolute top-0 right-0 w-64 h-64 bg-yellow-500/5 rounded-full blur-[100px] -translate-y-1/2 translate-x-1/2" />
                                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-4">
                                        <h3 className="text-sm font-black text-white uppercase tracking-widest">10-Year Liability Curve</h3>
                                        <div className="flex flex-wrap gap-4 text-[9px] font-black uppercase tracking-[0.2em]">
                                            <div className="flex items-center gap-2 px-3 py-1.5 rounded-full bg-yellow-500/10 text-yellow-500 border border-yellow-500/30">
                                                <div className="w-2 h-2 rounded-full bg-yellow-500" /> Scenario A
                                            </div>
                                            {isComparisonMode && (
                                                <div className="flex items-center gap-2 px-3 py-1.5 rounded-full bg-cyan-500/10 text-cyan-400 border border-cyan-400/30">
                                                    <div className="w-2 h-2 rounded-full bg-cyan-400" /> Scenario B
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    <div className="h-[400px] w-full">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <AreaChart data={projectionData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
                                                <defs>
                                                    <linearGradient id="gradA" x1="0" y1="0" x2="0" y2="1">
                                                        <stop offset="5%" stopColor="#eab308" stopOpacity={0.2}/>
                                                        <stop offset="95%" stopColor="#eab308" stopOpacity={0}/>
                                                    </linearGradient>
                                                    <linearGradient id="gradB" x1="0" y1="0" x2="0" y2="1">
                                                        <stop offset="5%" stopColor="#22d3ee" stopOpacity={0.2}/>
                                                        <stop offset="95%" stopColor="#22d3ee" stopOpacity={0}/>
                                                    </linearGradient>
                                                </defs>
                                                <CartesianGrid strokeDasharray="4 4" stroke="#1e293b" vertical={false} />
                                                <XAxis dataKey="year" stroke="#94a3b8" fontSize={11} fontWeight="bold" tickLine={false} axisLine={false} dy={15} />
                                                <YAxis stroke="#94a3b8" fontSize={11} fontWeight="bold" tickLine={false} axisLine={false} tickFormatter={(v) => `R${(v/1000).toFixed(0)}k`} />
                                                <Tooltip content={<CustomTooltip />} cursor={{ stroke: '#334155', strokeWidth: 2 }} />
                                                <Area type="monotone" dataKey="scenarioA" stroke="#eab308" strokeWidth={4} fill="url(#gradA)" animationDuration={1000} />
                                                {isComparisonMode && <Area type="monotone" dataKey="scenarioB" stroke="#22d3ee" strokeWidth={4} fill="url(#gradB)" animationDuration={1000} />}
                                            </AreaChart>
                                        </ResponsiveContainer>
                                    </div>
                                </div>

                                {/* Table */}
                                <div className="bg-[#151b23] border border-slate-700 rounded-3xl overflow-hidden shadow-2xl">
                                    <div className="overflow-x-auto custom-scrollbar">
                                        <table className="w-full text-left text-[11px] border-collapse">
                                            <thead>
                                                <tr className="bg-slate-800/80 text-slate-300 border-b border-slate-700 uppercase tracking-widest font-black">
                                                    <th className="p-5">Index</th>
                                                    <th className="p-5">Year</th>
                                                    <th className="p-5">Annual A</th>
                                                    {isComparisonMode && <th className="p-5 text-cyan-400">Annual B</th>}
                                                    <th className="p-5 text-right">Running Total</th>
                                                    {isComparisonMode && <th className="p-5 text-right text-red-400">Var (B-A)</th>}
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-800">
                                                {projectionData.map((row, idx) => (
                                                    <tr key={row.year} className="hover:bg-white/5 transition-colors group">
                                                        <td className="p-5 font-black text-slate-500">{idx + 1}</td>
                                                        <td className="p-5 font-bold text-white tracking-tight">{row.year}</td>
                                                        <td className="p-5 font-mono text-slate-300">{formatCurrency(row.scenarioA)}</td>
                                                        {isComparisonMode && <td className="p-5 font-mono text-cyan-300/80">{formatCurrency(row.scenarioB)}</td>}
                                                        <td className="p-5 text-right font-mono font-black text-slate-200">{formatCurrency(row.totalA)}</td>
                                                        {isComparisonMode && <td className="p-5 text-right font-mono font-black text-red-400 bg-red-950/20 group-hover:bg-red-950/40 transition-all">+ {formatCurrency(row.delta)}</td>}
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>